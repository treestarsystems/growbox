# SPDX-License-Identifier: MIT-0
---
# tasks file for setup-seed

- name: Update apt cache
  ansible.builtin.apt:
    update_cache: true
    cache_valid_time: "{{ apt_cache_valid_time }}"
  retries: 3
  delay: 5
  register: apt_update
  until: apt_update is success
  tags:
    - update
    - packages

- name: Install required packages
  ansible.builtin.apt:
    name: "{{ packages_list_setup_seed }}"
    state: present
  retries: 3
  delay: 5
  tags:
    - packages

- name: Display installation complete message
  ansible.builtin.debug:
    msg: "All packages have been installed successfully"
  tags:
    - packages

---
# tasks: enable vlan module

- name: Enable 8021q (VLAN) kernel module
  ansible.builtin.lineinfile:
    path: /etc/modules
    line: '8021q'
    state: present
    create: yes
#    mode: '0644'
  become: yes
  tags:
    - kernel
    - vlan
    - network

- name: Load 8021q module immediately
  community.general.modprobe:
    name: 8021q
    state: present
  become: yes
  tags:
    - kernel
    - vlan
    - network

- name: Verify 8021q module is loaded
  ansible.builtin.shell: lsmod | grep 8021q
  register: module_check
  changed_when: false
  failed_when: module_check.rc != 0
  tags:
    - verify
