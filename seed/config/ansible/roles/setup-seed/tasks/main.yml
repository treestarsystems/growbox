# SPDX-License-Identifier: MIT-0
---
# tasks file for setup-seed

- name: "Apt: Update apt cache"
  ansible.builtin.apt:
   update_cache: true
   cache_valid_time: "{{ apt_cache_valid_time }}"
  retries: 3
  delay: 5
  register: apt_update
  until: apt_update is success
  tags:
   - update
   - packages

- name: "Apt: Install required packages"
  ansible.builtin.apt:
   name: "{{ packages_list_setup_seed }}"
   state: present
  retries: 3
  delay: 5
  tags:
   - packages

- name: "Apt: Display installation complete message"
  ansible.builtin.debug:
   msg: "All packages have been installed successfully"
  tags:
   - packages

# tasks: enable vlan module

- name: "VLAN: Enable 8021q kernel module"
  ansible.builtin.lineinfile:
   path: /etc/modules
   line: "8021q"
   state: present
   create: false
  become: true
  tags:
   - kernel
   - vlan
   - network

- name: "VLAN: Load 8021q module"
  community.general.modprobe:
   name: 8021q
   state: present
  become: true
  tags:
   - kernel
   - vlan
   - network

- name: "VLAN: Verify 8021q module is loaded"
  ansible.builtin.shell: set -o pipefail && lsmod | grep 8021q
  register: module_check
  changed_when: false
  failed_when: module_check.rc != 0
  tags:
   - verify
   - vlan
